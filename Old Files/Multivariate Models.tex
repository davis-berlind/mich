% document set up
\documentclass{article}
\usepackage[utf8]{inputenc}
\usepackage{fullpage}
\setlength{\parindent}{0cm}
\setlength{\parskip}{1em}

% math packages
\usepackage{amsfonts}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsthm}
\usepackage{enumitem}
\usepackage{bbm}

% general packages
\usepackage[colorlinks=true,linkcolor=blue,citecolor=blue]{hyperref}
\usepackage{natbib}

\newcommand\indep{\perp\!\!\!\perp}
\newcommand{\sforall}{\;\forall\;}
\newcommand{\E}{\mathbb{E}}
\renewcommand{\Pr}{\mathbb{P}}
\newcommand{\Var}{\text{Var}}
\newcommand{\Cov}{\text{Cov}}
\newcommand{\argmin}[1]{\underset{#1}{\text{arg min}}}
\newcommand{\argmax}[1]{\underset{#1}{\text{arg max}}}

\newtheorem{assumption}{Assumption}
\newtheorem{theorem}{Theorem}
\newtheorem{proposition}{Proposition}
\newtheorem{corollary}{Corollary}
\newtheorem{remark}{Remark}
\newtheorem{definition}{Definition}
\newtheorem{lemma}{Lemma}

\begin{document}

\section{Eigenvalue Change-Point Model}
Model:
\begin{align*}
    \mathbf{y}_t &\sim \overset{\text{ind.}}{\sim} \mathcal{N}_d \left(\mathbf{0}, [\mathbf{Q}_0 \boldsymbol{\Lambda}_t\mathbf{S}_t\mathbf{Q}_0^\intercal]^{-1}\right) \\
    \boldsymbol{\Lambda}_t &= \text{diag}(\{\lambda_{it} \}_{i=1}^d) \\
    \mathbf{S}_t &= \text{diag}\left(\left\{s_i^{\mathbbm{1}\{\gamma \geq t\}}\right\}_{i=1}^d\right) \\
    s_i &\overset{\text{i.i.d.}}{\sim} \text{Gamma}(u_0/2, v_0/2) \\
    \gamma &\sim \text{Categorical}(\boldsymbol{\pi}_{1:T}) \\
    \gamma &\indep \{s_i\}_{i=1}^d 
\end{align*}
Posterior:
\begin{align*}
    s_i \;|\; \gamma = t, \mathbf{y}_{1:T} &\overset{\text{ind.}}{\sim} \text{Gamma}(\overline{u}_t, \overline{v}_{it}) \\
    \gamma \;|\; \mathbf{y}_{1:T} &\sim \text{Categorical}(\overline{\boldsymbol{\pi}}_{1:T}) \\
    \overline{u}_t &= \frac{u_0 + T-t+1}{2} \\
    \overline{v}_{it} &= \frac{v_0 + \sum_{t'=t}^T \lambda_{t'i}[\mathbf{Q}^\intercal_0\mathbf{y}_{t'}]^2_{i}}{2} \\
    \overline{\pi}_t &\propto \pi_t \exp\left(-\frac{1}{2}\sum_{t'=1}^{t-1} \lVert\boldsymbol{\Lambda}^{\frac{1}{2}}_{t}\mathbf{Q}_0^\intercal\mathbf{y}_{t'}\rVert^2_2\right)\prod_{i=1}^d \Gamma(\overline{u}_t) \overline{v}_{it}^{-\overline{u}_t}
\end{align*}
\small
\begin{align*}
    p(\{s_i\}_{i=1}^d, \gamma = t \;|\; \mathbf{y}_{1:T}) &\propto  p(\mathbf{y}_{1:T} \;|\; \{s_i\}_{i=1}^d, \gamma = t) \pi_t \prod_{i=1}^T p(s_i) \\
    &\propto \pi_t \prod_{t'=1}^T |\mathbf{Q}_0 \boldsymbol{\Lambda}_{t'}\mathbf{S}_{t'}\mathbf{Q}_0^\intercal|^{\frac{1}{2}} \exp\left[-\frac{1}{2}\sum_{t'=1}^T \lVert \boldsymbol{\Lambda}^{\frac{1}{2}}_{t'}\mathbf{S}^{\frac{1}{2}}_{t'}\mathbf{Q}_0^\intercal\mathbf{y}_{t'}\rVert_2^2\right] \prod_{i=1}^d s_i^{\frac{u_0}{2}-1} \exp\left[-\frac{v_0s_i}{2}\right] \\
    &= \pi_t \exp\left[-\frac{1}{2}\sum_{t'=1}^{t-1} \lVert \boldsymbol{\Lambda}^{\frac{1}{2}}_{t'}\mathbf{Q}_0^\intercal\mathbf{y}_{t'}\rVert_2^2\right] \exp\left[-\frac{1}{2}\sum_{t'=t}^T \lVert \boldsymbol{\Lambda}^{\frac{1}{2}}_{t'}\mathbf{S}^{\frac{1}{2}}_{t'}\mathbf{Q}_0^\intercal\mathbf{y}_{t'}\rVert_2^2\right] \prod_{i=1}^d s_i^{\frac{u_0 + T-t+1}{2} - 1} \exp\left[-\frac{v_0s_i}{2}\right] \tag{$\gamma = t$} \\
    &= \pi_t \exp\left[-\frac{1}{2}\sum_{t'=1}^{t-1} \lVert \boldsymbol{\Lambda}^{\frac{1}{2}}_{t'}\mathbf{Q}_0^\intercal\mathbf{y}_{t'}\rVert_2^2\right] \prod_{i=1}^d s_i^{\frac{u_0 + T-t+1}{2} - 1} \exp\left[-s_0\left(\frac{v_0 + \sum_{t'=t}^T\lambda_{t'i}[\mathbf{Q}^\intercal_0\mathbf{y}_{t'}]^2_{i}}{2}\right)\right] \\
    &= \pi_t \exp\left[-\frac{1}{2}\sum_{t'=1}^{t-1} \lVert \boldsymbol{\Lambda}^{\frac{1}{2}}_{t'}\mathbf{Q}_0^\intercal\mathbf{y}_{t'}\rVert_2^2\right] \prod_{i=1}^d \frac{\Gamma(\frac{u_0 + T-t+1}{2})}{\left(\frac{v_0 + \sum_{t'=t}^T\lambda_{t'i}[\mathbf{Q}^\intercal_0\mathbf{y}_{t'}]^2_{i}}{2}\right)^{\frac{u_0 + T-t+1}{2}}} \\
    &\quad\times \prod_{i=1}^d \frac{\left(\frac{v_0 + \sum_{t'=t}^T\lambda_{t'i}[\mathbf{Q}^\intercal_0\mathbf{y}_{t'}]^2_{i}}{2}\right)^{\frac{u_0 + T-t+1}{2}}}{\Gamma(\frac{u_0 + T-t+1}{2})}s_i^{\frac{u_0 + T-t+1}{2} - 1} \exp\left[-s_0\left(\frac{v_0 + \sum_{t'=t}^T\lambda_{t'i}[\mathbf{Q}^\intercal_0\mathbf{y}_{t'}]^2_{i}}{2}\right)\right] 
\end{align*}
\normalsize

\end{document}