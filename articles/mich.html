<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Introduction to mich • mich</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to mich">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">mich</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="external-link nav-link" href="https://davis-berlind.github.io/"><span class="fa fa-home"></span> Home</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/mich.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/step_count.html">Detecting Changes in Daily Step Count</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/davis-berlind/mich/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Introduction to mich</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/davis-berlind/mich/blob/main/vignettes/mich.Rmd" class="external-link"><code>vignettes/mich.Rmd</code></a></small>
      <div class="d-none name"><code>mich.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">222</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://davis-berlind.github.io/mich/">mich</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="basic-usage">Basic Usage<a class="anchor" aria-label="anchor" href="#basic-usage"></a>
</h2>
<p>The main function of the package is <code><a href="../reference/mich.html">mich()</a></code>, which takes
a vector or matrix of observations <code>y</code> and returns a
<code>mich.fit</code> object containing a variational approximation to
the posterior distribution of the change-points in the mean and/or
variance of <code>y</code>. The integer valued parameters
<code>L</code>, <code>K</code>, and <code>J</code> specify the
respective numbers of mean, variance, and joint mean and variance
change-points in <code>y</code>. In each of the examples below, we
sample a series with two changes in the mean and/or variance at times
<code>101</code> and <code>201</code> and use <code><a href="../reference/mich.html">mich()</a></code> to
estimate and construct 95% credible sets around the locations of the
changes.</p>
<div class="section level3">
<h3 id="mean-changes">Mean Changes<a class="anchor" aria-label="anchor" href="#mean-changes"></a>
</h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># generate univariate data with two mean change-points</span></span>
<span><span class="va">y</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">100</span>,<span class="fl">0</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">100</span>,<span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">100</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># fit two mean-scp components</span></span>
<span><span class="va">fit</span> <span class="op">=</span> <span class="fu"><a href="../reference/mich.html">mich</a></span><span class="op">(</span><span class="va">y</span>, L <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit</span>, level <span class="op">=</span> <span class="fl">0.95</span><span class="op">)</span></span>
<span><span class="co">#&gt; Univariate MICH Model:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ELBO: -242.324141949562; Converged: TRUE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; L = 2 Mean-SCP Component(s); 2 Detected Mean Change-Point(s):</span></span>
<span><span class="co">#&gt;   change.points lower.0.95.credible.set upper.0.95.credible.set</span></span>
<span><span class="co">#&gt; 1           101                     100                     102</span></span>
<span><span class="co">#&gt; 2           203                     198                     207</span></span></code></pre></div>
<p>The summary output shows us the ELBO for the fitted model as well as
the estimated locations of the changes and the lower and upper bounds of
the <code>level</code>-level credible sets around each change. Because
we called <code><a href="../reference/mich.html">mich()</a></code> with <code>L &gt; 0</code>, the returned
<code>mich.fit</code> object contains a named list
<code>mean_model</code> that contains the posterior parameters for each
of the <code>L</code> components in the model. The most important
element is <code>pi_bar</code>, which is a T x L matrix of posterior
change-point location probabilities (for a detailed description of each
element of <code>mean_model</code>, type <code><a href="../reference/mich.html">?mich</a></code> in the
console). We can use <code>pi_bar</code> along with the function
<code><a href="../reference/mich_sets.html">mich_sets()</a></code> to construct change-point estimates and
credible sets.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># MAP estimates with 95% credible sets</span></span>
<span><span class="fu"><a href="../reference/mich_sets.html">mich_sets</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">mean_model</span><span class="op">$</span><span class="va">pi_bar</span>, level <span class="op">=</span> <span class="fl">0.95</span><span class="op">)</span></span>
<span><span class="co">#&gt; $cp</span></span>
<span><span class="co">#&gt; [1] 101 203</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $sets</span></span>
<span><span class="co">#&gt; $sets[[1]]</span></span>
<span><span class="co">#&gt; [1] 100 101 102</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $sets[[2]]</span></span>
<span><span class="co">#&gt; [1] 198 199 200 201 203 204 207</span></span></code></pre></div>
<p>The <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> function is extended to the
<code>mich.fit</code> class and uses <code><a href="../reference/mich_sets.html">mich_sets()</a></code> to plot
the returned MAP estimates as well as the estimated signal if
<code>signal == TRUE</code> and credible sets if <code>cs == TRUE</code>
(note that as in the plot below, these truly are sets, not
intervals).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fit</span>, cs <span class="op">=</span> <span class="cn">TRUE</span>, level <span class="op">=</span> <span class="fl">0.95</span>, signal <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="mich_files/figure-html/unnamed-chunk-5-1.png" width="99%"></p>
</div>
<div class="section level3">
<h3 id="variance-changes">Variance Changes<a class="anchor" aria-label="anchor" href="#variance-changes"></a>
</h3>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># generate univariate data with two variance change-points</span></span>
<span><span class="va">y</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">100</span>,<span class="fl">0</span>,<span class="fl">10</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">100</span>,<span class="fl">0</span>,<span class="fl">3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">100</span>,<span class="fl">0</span>,<span class="fl">6</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># fit two var-scp components</span></span>
<span><span class="va">fit</span> <span class="op">=</span> <span class="fu"><a href="../reference/mich.html">mich</a></span><span class="op">(</span><span class="va">y</span>, K <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit</span>, level <span class="op">=</span> <span class="fl">0.95</span><span class="op">)</span></span>
<span><span class="co">#&gt; Univariate MICH Model:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ELBO: -362.67485155576; Converged: TRUE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; K = 2 Var-SCP Component(s); 2 Detected Variance Change-Point(s):</span></span>
<span><span class="co">#&gt;   change.points lower.0.95.credible.set upper.0.95.credible.set</span></span>
<span><span class="co">#&gt; 1           100                     100                     104</span></span>
<span><span class="co">#&gt; 2           201                     196                     201</span></span></code></pre></div>
<p>The posterior quantities are now stored in
<code>fit$var_model$pi_bar</code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fit</span>, cs <span class="op">=</span> <span class="cn">TRUE</span>, level <span class="op">=</span> <span class="fl">0.95</span>, signal <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="mich_files/figure-html/unnamed-chunk-8-1.png" width="99%"></p>
</div>
<div class="section level3">
<h3 id="mean-variance-changes">Mean-Variance Changes<a class="anchor" aria-label="anchor" href="#mean-variance-changes"></a>
</h3>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># generate univariate data with two mean-variance change-points</span></span>
<span><span class="va">y</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">100</span>,<span class="fl">0</span>,<span class="fl">10</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">100</span>,<span class="fl">10</span>,<span class="fl">3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">100</span>,<span class="fl">0</span>,<span class="fl">6</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># fit two meanvar-scp components</span></span>
<span><span class="va">fit</span> <span class="op">=</span> <span class="fu"><a href="../reference/mich.html">mich</a></span><span class="op">(</span><span class="va">y</span>, J <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit</span>, level <span class="op">=</span> <span class="fl">0.95</span><span class="op">)</span></span>
<span><span class="co">#&gt; Univariate MICH Model:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ELBO: -220.537132456086; Converged: TRUE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; J = 2 MeanVar-SCP Component(s); 2 Detected Mean-Variance Change-Point(s):</span></span>
<span><span class="co">#&gt;   change.points lower.0.95.credible.set upper.0.95.credible.set</span></span>
<span><span class="co">#&gt; 1           101                      99                     102</span></span>
<span><span class="co">#&gt; 2           201                     199                     201</span></span></code></pre></div>
<p>The posterior quantities are now stored in
<code>fit$meanvar_model$pi_bar</code>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fit</span>, cs <span class="op">=</span> <span class="cn">TRUE</span>, level <span class="op">=</span> <span class="fl">0.95</span>, signal <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="mich_files/figure-html/unnamed-chunk-11-1.png" width="99%"></p>
</div>
<div class="section level3">
<h3 id="multiple-change-types">Multiple Change-Types<a class="anchor" aria-label="anchor" href="#multiple-change-types"></a>
</h3>
<p>Note that by default <code>L=K=J=0</code>, so the call
<code>mich(y)</code> will fit the null model assuming no changes are
present in the mean or variance of <code>y</code>. It is also possible
to fit <code><a href="../reference/mich.html">mich()</a></code> with multiple kinds of changes, e.g. we could
rerun the last example with one of the changes misspecified as just a
mean change.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># generate univariate data with two mean-variance change-points</span></span>
<span><span class="va">y</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">100</span>,<span class="fl">0</span>,<span class="fl">10</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">100</span>,<span class="fl">10</span>,<span class="fl">3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">100</span>,<span class="fl">0</span>,<span class="fl">6</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># fit one mean-scp component and meanvar-scp component</span></span>
<span><span class="va">fit</span> <span class="op">=</span> <span class="fu"><a href="../reference/mich.html">mich</a></span><span class="op">(</span><span class="va">y</span>, L<span class="op">=</span><span class="fl">1</span>, J <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit</span>, level <span class="op">=</span> <span class="fl">0.95</span><span class="op">)</span></span>
<span><span class="co">#&gt; Univariate MICH Model:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ELBO: -254.723737904752; Converged: TRUE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; L = 1 Mean-SCP Component(s); 1 Detected Mean Change-Point(s):</span></span>
<span><span class="co">#&gt;   change.points lower.0.95.credible.set upper.0.95.credible.set</span></span>
<span><span class="co">#&gt; 1           101                      86                     103</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; J = 1 MeanVar-SCP Component(s); 1 Detected Mean-Variance Change-Point(s):</span></span>
<span><span class="co">#&gt;   change.points lower.0.95.credible.set upper.0.95.credible.set</span></span>
<span><span class="co">#&gt; 1           200                     199                     202</span></span></code></pre></div>
<p>We see that the model uses the mean-component to fit the first change
and the mean-variance component to fit the second change.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fit</span>, cs <span class="op">=</span> <span class="cn">TRUE</span>, level <span class="op">=</span> <span class="fl">0.95</span><span class="op">)</span></span></code></pre></div>
<p><img src="mich_files/figure-html/unnamed-chunk-14-1.png" width="99%"></p>
</div>
<div class="section level3">
<h3 id="multivariate-mean-changes">Multivariate Mean Changes<a class="anchor" aria-label="anchor" href="#multivariate-mean-changes"></a>
</h3>
<p>In the case where <code>y</code> is a T x d matrix,
<code><a href="../reference/mich.html">mich()</a></code> can detect mean changes that are shared across all
or some of the columns. The columns of <code>y</code> do not need to be
independent and by default <code><a href="../reference/mich.html">mich()</a></code> will attempt to estimate
the precision matrix of the series (see the discussion of the
<code>fit_scale</code> parameter below). In the following example
<code>y[,1]</code> and <code>y[,2]</code> are positively correlated.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="cn">T</span> <span class="op">&lt;-</span> <span class="fl">150</span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span></span>
<span><span class="co"># covariance matrix</span></span>
<span><span class="va">Sigma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.7</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.7</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Sigma_eigen</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/eigen.html" class="external-link">eigen</a></span><span class="op">(</span><span class="va">Sigma</span><span class="op">)</span></span>
<span><span class="va">e_vectors</span> <span class="op">&lt;-</span> <span class="va">Sigma_eigen</span><span class="op">$</span><span class="va">vectors</span></span>
<span><span class="va">e_values</span> <span class="op">&lt;-</span> <span class="va">Sigma_eigen</span><span class="op">$</span><span class="va">values</span></span>
<span><span class="va">Sigma_sd</span> <span class="op">&lt;-</span> <span class="va">e_vectors</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">e_values</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">e_vectors</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># construct mean signal</span></span>
<span><span class="va">mu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">mu_t</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>, nrow <span class="op">=</span> <span class="fl">70</span>, ncol <span class="op">=</span> <span class="va">d</span><span class="op">)</span></span>
<span><span class="va">mu_t</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">mu_t</span>, <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">30</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="va">mu</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mu_t</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">mu_t</span>, <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>, nrow <span class="op">=</span> <span class="fl">50</span>, ncol <span class="op">=</span> <span class="va">d</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># generate data</span></span>
<span><span class="va">Z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">d</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="va">mu_t</span> <span class="op">+</span> <span class="va">Z</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">Sigma_sd</span></span>
<span></span>
<span><span class="co"># fit two multivariate mean-scp components</span></span>
<span><span class="va">fit</span> <span class="op">=</span> <span class="fu"><a href="../reference/mich.html">mich</a></span><span class="op">(</span><span class="va">Y</span>, L <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fit</span>, cs <span class="op">=</span> <span class="cn">TRUE</span>, level <span class="op">=</span> <span class="fl">0.95</span>, signal <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="mich_files/figure-html/unnamed-chunk-17-1.png" width="99%"></p>
</div>
</div>
<div class="section level2">
<h2 id="selecting-l-k-and-j">Selecting <code>L</code>, <code>K</code>, and <code>J</code><a class="anchor" aria-label="anchor" href="#selecting-l-k-and-j"></a>
</h2>
<p>In the previous section we treated the numbers of each kind of
change-point as known quantities, but more often than not we need to
estimate these parameters. One option is to set <code>L</code>,
<code>K</code>, and <code>J</code> equal to some large numbers that
upper bound each kind of change. For example if we think there are at
most five mean changes in the data then we can set
<code>L = 5</code>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># generate univariate data with two mean change-points</span></span>
<span><span class="va">y</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">100</span>,<span class="fl">0</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">100</span>,<span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">100</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># fit five mean-scp components</span></span>
<span><span class="va">fit</span> <span class="op">=</span> <span class="fu"><a href="../reference/mich.html">mich</a></span><span class="op">(</span><span class="va">y</span>, L <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit</span>, level <span class="op">=</span> <span class="fl">0.95</span><span class="op">)</span></span>
<span><span class="co">#&gt; Univariate MICH Model:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ELBO: -226.57173121568; Converged: TRUE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; L = 5 Mean-SCP Component(s); 2 Detected Mean Change-Point(s):</span></span>
<span><span class="co">#&gt;   change.points lower.0.95.credible.set upper.0.95.credible.set</span></span>
<span><span class="co">#&gt; 1           101                     100                     103</span></span>
<span><span class="co">#&gt; 2           201                     201                     201</span></span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fit</span>, cs <span class="op">=</span> <span class="cn">TRUE</span>, level <span class="op">=</span> <span class="fl">0.95</span><span class="op">)</span></span></code></pre></div>
<p><img src="mich_files/figure-html/unnamed-chunk-20-1.png" width="99%"></p>
<p>Note that the model still only detected the two true change-points.
The plot below shows that this is because the extra three components we
included have very diffuse posterior distributions that do not satisfy
the detection criterion of having credible sets containing fewer than
<code>log(T)^2</code> indices (see Corollary 1 of <a href="https://arxiv.org/abs/2507.01558" class="external-link">Berlind, Cappello, and Madrid
Padilla (2025)</a>).</p>
<p><img src="mich_files/figure-html/unnamed-chunk-21-1.png" width="99%"></p>
<div class="section level3">
<h3 id="auto-mich">Auto-MICH<a class="anchor" aria-label="anchor" href="#auto-mich"></a>
</h3>
<p>Alternatively, we can use the ELBO as an approximation to marginal
likelihood of the model and automatically select the <code>L</code>,
<code>K</code>, and <code>J</code> that maximizes the ELBO. This option
is implemented in <code><a href="../reference/mich.html">mich()</a></code> via the <code>L_auto</code>,
<code>K_auto</code>, and <code>J_auto</code> parameters. If
<code>L_auto == TRUE</code>, then <code><a href="../reference/mich.html">mich()</a></code> searches for the
number of mean changes between <code>L</code> and <code>L_max</code>
that maximize the EBLO.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># fit mich with L selected automatically</span></span>
<span><span class="va">fit</span> <span class="op">=</span> <span class="fu"><a href="../reference/mich.html">mich</a></span><span class="op">(</span><span class="va">y</span>, L_auto <span class="op">=</span> <span class="cn">TRUE</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span>, restart <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> </span>
<span><span class="co">#&gt; [1] "(L = 0, K = 0, J = 0): ELBO = -304.942450777235; Counter: 6"</span></span>
<span><span class="co">#&gt; [1] "(L = 1, K = 0, J = 0): ELBO = -298.331456279222; Counter: 6"</span></span>
<span><span class="co">#&gt; [1] "(L = 2, K = 0, J = 0): ELBO = -211.047722355175; Counter: 6"</span></span>
<span><span class="co">#&gt; [1] "(L = 3, K = 0, J = 0): ELBO = -215.885482079647; Counter: 6"</span></span>
<span><span class="co">#&gt; [1] "(L = 4, K = 0, J = 0): ELBO = -220.962514999129; Counter: 5"</span></span>
<span><span class="co">#&gt; [1] "(L = 5, K = 0, J = 0): ELBO = -226.200102703732; Counter: 4"</span></span>
<span><span class="co">#&gt; [1] "(L = 6, K = 0, J = 0): ELBO = -231.558781723112; Counter: 3"</span></span>
<span><span class="co">#&gt; [1] "(L = 7, K = 0, J = 0): ELBO = -237.011609035981; Counter: 2"</span></span>
<span><span class="co">#&gt; [1] "(L = 8, K = 0, J = 0): ELBO = -242.541140918896; Counter: 1"</span></span>
<span><span class="co">#&gt; [1] "(L = 9, K = 0, J = 0): ELBO = -248.136597702824; Counter: 0"</span></span>
<span><span class="co">#&gt; [1] "Merging. Merge Counter: 1"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit</span>, level <span class="op">=</span> <span class="fl">0.95</span><span class="op">)</span></span>
<span><span class="co">#&gt; Univariate MICH Model:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ELBO: -211.048798898986; Converged: TRUE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; L = 2 Mean-SCP Component(s); 2 Detected Mean Change-Point(s):</span></span>
<span><span class="co">#&gt;   change.points lower.0.95.credible.set upper.0.95.credible.set</span></span>
<span><span class="co">#&gt; 1           101                     100                     103</span></span>
<span><span class="co">#&gt; 2           201                     201                     201</span></span></code></pre></div>
<p>Once again <code><a href="../reference/mich.html">mich()</a></code> is able to correctly identify the
mean-changes, but now setting <code>L_auto == TRUE</code> results in a
model with only two components.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fit</span>, cs <span class="op">=</span> <span class="cn">TRUE</span>, level <span class="op">=</span> <span class="fl">0.95</span><span class="op">)</span></span></code></pre></div>
<p><img src="mich_files/figure-html/unnamed-chunk-24-1.png" width="99%"></p>
<p>Similarly, if <code>K_auto == TRUE</code> or
<code>J_auto == TRUE</code> then <code><a href="../reference/mich.html">mich()</a></code> searches for the
optimal number of variance and mean-variance components to include in
the model. It is possible to have some combination of
<code>L_auto</code>, <code>K_auto</code>, and/or <code>J_auto</code> set
equal to true, in which case <code><a href="../reference/mich.html">mich()</a></code> takes turns
incrementing <code>L</code>, <code>K</code>, and <code>J</code> and
moves in the direction that results in the largest increase in the
ELBO.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># fit mich with L selected automatically</span></span>
<span><span class="va">fit</span> <span class="op">=</span> <span class="fu"><a href="../reference/mich.html">mich</a></span><span class="op">(</span><span class="va">y</span>, L_auto <span class="op">=</span> <span class="cn">TRUE</span>, J_auto <span class="op">=</span> <span class="cn">TRUE</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span>, restart <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> </span>
<span><span class="co">#&gt; [1] "(L = 0, K = 0, J = 0): ELBO = -304.942450777235"</span></span>
<span><span class="co">#&gt; [1] "(L = 0, K = 0, J = 1): ELBO = -290.56141335325"</span></span>
<span><span class="co">#&gt; [1] "(L = 1, K = 0, J = 0): ELBO = -298.331456279222"</span></span>
<span><span class="co">#&gt; [1] "(L = 0, K = 0, J = 2): ELBO = -226.747670431813"</span></span>
<span><span class="co">#&gt; [1] "(L = 1, K = 0, J = 1): ELBO = -308.61486984484"</span></span>
<span><span class="co">#&gt; [1] "(L = 0, K = 0, J = 3): ELBO = -235.207021249792"</span></span>
<span><span class="co">#&gt; [1] "(L = 1, K = 0, J = 2): ELBO = -232.203193790049"</span></span>
<span><span class="co">#&gt; [1] "(L = 1, K = 0, J = 3): ELBO = -247.407027549628"</span></span>
<span><span class="co">#&gt; [1] "(L = 2, K = 0, J = 2): ELBO = -232.674862962078"</span></span>
<span><span class="co">#&gt; [1] "(L = 2, K = 0, J = 3): ELBO = -247.141610997682"</span></span>
<span><span class="co">#&gt; [1] "(L = 3, K = 0, J = 2): ELBO = -238.433249627662"</span></span>
<span><span class="co">#&gt; [1] "(L = 3, K = 0, J = 3): ELBO = -250.526457976407"</span></span>
<span><span class="co">#&gt; [1] "(L = 4, K = 0, J = 2): ELBO = -243.104705526495"</span></span>
<span><span class="co">#&gt; [1] "(L = 4, K = 0, J = 3): ELBO = -257.781771835369"</span></span>
<span><span class="co">#&gt; [1] "(L = 5, K = 0, J = 2): ELBO = -248.914056107144"</span></span>
<span><span class="co">#&gt; [1] "(L = 5, K = 0, J = 3): ELBO = -264.495764094317"</span></span>
<span><span class="co">#&gt; [1] "(L = 6, K = 0, J = 2): ELBO = -254.768484151035"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit</span>, level <span class="op">=</span> <span class="fl">0.95</span><span class="op">)</span></span>
<span><span class="co">#&gt; Univariate MICH Model:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ELBO: -226.747670431813; Converged: TRUE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; J = 2 MeanVar-SCP Component(s); 2 Detected Mean-Variance Change-Point(s):</span></span>
<span><span class="co">#&gt;   change.points lower.0.95.credible.set upper.0.95.credible.set</span></span>
<span><span class="co">#&gt; 1           101                     100                     103</span></span>
<span><span class="co">#&gt; 2           201                     201                     201</span></span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fit</span>, cs <span class="op">=</span> <span class="cn">TRUE</span>, level <span class="op">=</span> <span class="fl">0.95</span><span class="op">)</span></span></code></pre></div>
<p><img src="mich_files/figure-html/unnamed-chunk-27-1.png" width="99%"></p>
<p>Lastly, <code><a href="../reference/mich.html">mich()</a></code> accepts the integer valued parameter
<code>increment</code>, which determines how many components are added
to the model as <code><a href="../reference/mich.html">mich()</a></code> searches for the best
<code>L</code>, <code>K</code>, and/or <code>J</code>, and
<code>restart</code>, which causes <code><a href="../reference/mich.html">mich()</a></code> to refit the
model from a null parameterization once the ELBO stops increasing, which
can help the variational algorithm escape local minima.</p>
</div>
</div>
<div class="section level2">
<h2 id="priors">Priors<a class="anchor" aria-label="anchor" href="#priors"></a>
</h2>
<div class="section level3">
<h3 id="prior-change-point-location-probabilities">Prior Change-Point Location Probabilities<a class="anchor" aria-label="anchor" href="#prior-change-point-location-probabilities"></a>
</h3>
<p>The priors for the change-point locations are controlled by the
<code>pi_l</code>, <code>pi_k</code>, and <code>pi_j</code> parameters
(each corresponding the the prior locations of mean, variance, and mean
and variance changes). By default these parameters are set equal to
<code>"weighted"</code>, in which case the functions
<code><a href="../reference/log_mean_prior.html">log_mean_prior()</a></code>, <code><a href="../reference/log_var_prior.html">log_var_prior()</a></code>, and
<code><a href="../reference/log_meanvar_prior.html">log_meanvar_prior()</a></code> are used to calculated weighted priors
that ensure diffuse posterior distributions in the absence of any
changes in the mean and/or variance of <code>y</code> (see Appendix C.2
of <a href="https://arxiv.org/abs/2507.01558" class="external-link">Berlind, Cappello, and
Madrid Padilla (2025)</a> for a detailed discussion). Setting
<code>pi_l</code>, <code>pi_k</code>, or <code>pi_j</code> equal to
<code>"uniform"</code> will force <code><a href="../reference/mich.html">mich()</a></code> to use the uniform
prior <code>rep(1/T, T)</code> instead. The user can also provide their
own priors by setting <code>pi_l</code>, <code>pi_k</code>, or
<code>pi_j</code> equal to a vector <code>pi</code> such that
<code>length(pi) == length(y)</code> and <code>sum(pi) == 1</code>, in
which case <code>pi</code> will be used as the prior for all of the
model components. <code>pi</code> can also be a matrix of probabilities
so long as <code>nrow(pi) == length(y)</code>,
<code>all(colSums(pi) == 1) == TRUE</code>, and if
<code>pi_l = pi</code> then <code>ncol(pi) == L</code> and so on for
<code>pi_k</code> and <code>pi_j</code>.</p>
</div>
<div class="section level3">
<h3 id="precision-shape-and-rate-parameters">Precision, Shape, and Rate Parameters<a class="anchor" aria-label="anchor" href="#precision-shape-and-rate-parameters"></a>
</h3>
<p>Each of the prior precision, shape, and rate parameters in the model
is set equal to <code>0.001</code> by default. The user can change these
parameters by modifying <code>omega_l, u_k, v_k, omega_j, u_j</code> and
<code>v_j</code>, but the sensitivity analysis in <a href="https://arxiv.org/abs/2507.01558" class="external-link">Berlind, Cappello, and Madrid
Padilla (2025)</a> indicates that as long as these values are small,
they do not meaningfully alter the output of <code><a href="../reference/mich.html">mich()</a></code>.</p>
</div>
</div>
<div class="section level2">
<h2 id="standardization">Standardization<a class="anchor" aria-label="anchor" href="#standardization"></a>
</h2>
<p>When <code>standardize == TRUE</code>, <code><a href="../reference/mich.html">mich()</a></code> will
center and rescale the data before running the main variational
algorithm. While this step can help improve performance, because the
location of the first change-point is unknown, it does not guarantee
that <code>y</code> will begin centered at zero or have unit variance.
Instead, <code><a href="../reference/mich.html">mich()</a></code> estimates and returns an intercept
<code>mu_0</code> and initial precision <code>lambda_0</code> by default
(when <code>y</code> is a matrix, the estimated variance-covariance
matrix is returned instead as <code>Sigma</code>). If <code>y</code> is
known to be centered at zero or have unit variance, than the estimation
of these parameters can be avoided by setting
<code>fit_intecept == FALSE</code> and/or
<code>fit_scale == FALSE</code>.</p>
</div>
<div class="section level2">
<h2 id="additonal-parameters">Additonal Parameters<a class="anchor" aria-label="anchor" href="#additonal-parameters"></a>
</h2>
<p>Additional control parameters can be viewed by typing
<code><a href="../reference/mich.html">?mich</a></code> in the console. These include the convergence
criterion <code>tol</code>, a <code>verbose</code> parameter that will
prompt <code><a href="../reference/mich.html">mich()</a></code> to provide feedback as it fits the model, and
a <code>reverse</code> parameter that will make <code><a href="../reference/mich.html">mich()</a></code> fit
to <code>y[T:1]</code> in place of <code>y</code> which can occasionally
improve the model fit.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Davis Berlind.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
